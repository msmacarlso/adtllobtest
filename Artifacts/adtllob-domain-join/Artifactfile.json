{
  "$schema": "https://raw.githubusercontent.com/Azure/azure-devtestlab/master/schemas/2016-11-28/dtlArtifacts.json",
  "title": "Active Directory Domain Join",
  "description": "Joins a Windows VM to an Active Directory Domain. Requires that the Windows operating system can resolve the domain name and domain controller via DNS.",
  "tags": [
    "Windows",
    "Active Directory"
  ],
  "iconUri": "https://raw.githubusercontent.com/Azure/azure-devtestlab/master/Artifacts/windows-domain-join/domainJoinArtifact.png",
  "targetOsType": "Windows",
  "parameters": { 
      "domainJoinUser": {
          "type": "string",
          "displayName": "Domain Join User Account",
          "description": "The user account with rights to join the system to the domain (e.g. \"CORP\\user\" or \"user@corp.contoso.com\")"
      },
      "domainJoinUserPassword": {
          "type": "securestring",
          "displayName": "Domain Join User Account Password",
          "description": "Password of the Domain Join User Account."
      }
   },
  "runAzureVMExtension": {
    "publisher": "Microsoft.Compute",
    "type": "JsonADDomainExtension",
    "typeHandlerVersion": "1.3",
    "autoUpgradeMinorVersion": true,
    "settings": {
          "Name": "redmond.corp.microsoft.com",
          "OUPath": "CN=Computers,DC=redmond,DC=corp,DC=microsoft,DC=com",
          "User": "[parameters('domainJoinUser')]",
          "Restart": "true",
          "Options": "3"
        },
    "protectedSettings": {
          "Password": "[parameters('domainJoinUserPassword')]"
    }
  }
}
